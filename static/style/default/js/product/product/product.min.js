"use strict";function changeOrder(a,t,i,e){var s="<dd><label>出发日期：</label>"+t+'</dd><dd><label>成人价：</label><span class="ycolor">￥'+i+'</span>/人</dd><dd><label>儿童价：</label><span class="ycolor">￥'+e+'</span>/儿童</dd><dd><label>成人数：</label> <div class="num_view" data-type="child"><a href="javascript:;" class="min">-</a><span>1</span><a href="javascript:;" class="add">+</a><input type="hidden" id="adult" value="1"></div></dd><dd><label>儿童数：</label> <div class="num_view" data-type="adult"><a href="javascript:;" class="min">-</a><span>0</span><a href="javascript:;" class="add">+</a><input type="hidden" id="child" value="0"></div></dd>';a.html(s),numFun.init($(".num_view"))}function changeplane(a){var t=$(".prod_plane_info");$.ajax({url:$("#planeUrl").val(),type:"post",dataType:"json",data:{id:a}}).done(function(a){if(0==a.errno){var i="";$.each(a.ticket,function(a,t){i+='<div class="list"><ul>',0==t.type?i+='<li class="plane_type">去程</li>':1==t.type&&(i+='<li class="plane_type">返程</li>'),i+='<li class="plane_name"><p class="f14 mt5">'+t.company+"</p><p>"+t.time+"</p></li>",i+='<li class="plane_time"><p class="f14 b mt10">'+t.go_area+'</p><p class="f24 b mt10">'+t.go_time+'</p><p class="f14">'+t.go_airport+"</p></li>",i+='<li class="plane_img"></li>',i+='<li class="plane_time"><p class="f14 b mt10">'+t.return_area+'</p><p class="f24 b mt10">'+t.return_time+'</p><p class="f14">'+t.return_airport+"</p></li>",i+='<li class="plane_total"><p class="time_c mt5">航行时间</p><p>'+t.spend_time+"</p></li>",i+="</ul></div>"}),t.html(i)}})}!function(){function a(a,t){this.dom=$('<div class="calendar_box"></div>'),this.w=a.width(),this.prevBtn=$('<div class="calendar_prev"></div>'),this.nextBtn=$('<div class="calendar_next"></div>'),this.page=0,this.data=t,this.handle(),a.append(this.dom).append(this.prevBtn).append(this.nextBtn);var i=$(".calendar").length,e=this;this.dom.width(this.w*i),2>i?(this.prevBtn.addClass("none"),this.nextBtn.addClass("none")):i>=2&&this.prevBtn.addClass("none"),this.prevBtn.click(function(){return $(this).hasClass("none")?!1:void e.prev()}),this.nextBtn.click(function(){return $(this).hasClass("none")?!1:void e.next(i)})}a.prototype.handle=function(){var a=this.data,t=this;for(var i in a){var e=a[i].year_month.split("-"),s=parseInt(e[0],10),n=parseInt(e[1],10)-1,l=new Date(s,n,1,0,0,0),d=new Date(s,n+1,0,0,0,0),o=new Date,r=o.getFullYear()+"-"+(o.getMonth()<9?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"+(o.getDate()<10?"0"+o.getDate():o.getDate());t.create(a[i].year_month_days,r,l.getDay(),d.getDate(),a[i].year_month)}},a.prototype.create=function(a,t,i,e,s){for(var n=this,l=$('<div class="calendar" data-month='+s+"></div>"),d=$('<div class="title">'+s+"</div>"),o=$('<ul class="week_ul"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul>'),r=$('<ul class="day_ul"></ul>'),p="",c=1;42>=c;c++)if(i>=c)p+="<li></li>";else if(c>=i&&e+i>=c){var h=c-i,v=s+"-"+n.rDay(h),f="";$.each(a,function(a,t){t.year_month_day==v&&(f='<li class="has on" data-info='+v+","+t.price+","+t.child_price+","+t.id+","+t.stock+'><p class="text">'+h+'</p><p class="stock">剩余：'+t.stock+'</p><p class="price">￥'+t.price+"</p></li>")}),f?(p+=f,f=""):p+='<li class="has"><p class="text">'+h+"</p></li>"}else p+="<li></li>";r.html(p),l.append(d).append(o).append(r),n.dom.append(l)},a.prototype.rDay=function(a){return 9>=a?"0"+a:""+a},a.prototype.prev=function(){this.page--,this.dom.css("left","-"+this.w*this.page+"px"),this.nextBtn.hasClass("none")&&this.nextBtn.removeClass("none"),this.page<=0&&this.prevBtn.addClass("none")},a.prototype.next=function(a){this.page++,this.dom.css("left","-"+this.w*this.page+"px"),this.prevBtn.hasClass("none")&&this.prevBtn.removeClass("none"),this.page+1>=a&&this.nextBtn.addClass("none")},window.calendar=a}(),function(){function a(a,t){var i=this;this.addBtn=a.find(".add"),this.minBtn=a.find(".min"),this.text=a.find("span"),this.zNum=a.find("input"),this.oNum=$("#"+t),this.stockVal=$("#prodStock").val(),this.addBtn.click(function(){var a=parseInt(i.zNum.val()),t=parseInt(i.oNum.val());a+t<i.stockVal&&i.add()}),this.minBtn.click(function(){var a=parseInt(i.zNum.val());"child"==t?a>1&&i.min():a>0&&i.min()})}a.prototype.add=function(){var a=this.zNum.val();a++,this.zNum.val(a),this.text.text(a)},a.prototype.min=function(){var a=this.zNum.val();a--,this.zNum.val(a),this.text.text(a)},a.init=function(a){var t=this;a.each(function(){var a=$(this).data("type");new t($(this),a)})},window.numFun=a}(),$(".prod_slide .bd li").first().before($(".prod_slide .bd li").last()),$(".prod_slide").slide({mainCell:".bd ul",effect:"leftLoop",autoPlay:!0,vis:3}),$.ajax({url:$("#calendarUrl").val(),type:"post",dataType:"json",data:{id:$("#id").val()}}).done(function(a){if(0==a.errno){var t=a.items;new calendar($(".prod_calenda"),t)}}),$(".daywayback").each(function(){var a=new RegExp("\\[(.+?)\\]","g"),t=$(this).html(),i=t.replace(a,'<i class="tripicon $1"></i>');$(this).html(i)}),numFun.init($(".num_view")),$(".prod_calenda").on("click",".on",function(){var a=$(this);if(a.hasClass("active"))return!1;$(".prod_calenda li.active").removeClass("active"),a.addClass("active");var t=$(this).data("info").split(","),i=t[0],e=t[1],s=t[2],n=t[3],l=t[4];$("#prodTime").val(i),$("#prodAdultPrice").val(e),$("#prodChildPrice").val(s),$("#prodId").val(n),$("#prodStock").val(l),$(".prod_detail").find("h1").html("￥"+e),changeOrder($("#orderInfo"),i,e,s),changeplane(n)});var order=$(".order"),orderTop=order.offset().top,prodTabTitle=$(".prod_tab_title"),prodTabTitleTop=prodTabTitle.offset().top,dayList=$(".day_list"),dayListTop=dayList.offset().top;$(window).scroll(function(){var a=$(document).scrollTop();a>=orderTop?order.addClass("tag_fixed"):order.removeClass("tag_fixed"),a>=prodTabTitleTop?prodTabTitle.addClass("tag_fixed"):prodTabTitle.removeClass("tag_fixed"),a>=dayListTop-100&&a<=dayListTop+$(".prod_tab_trip").outerHeight()-500?dayList.find("div").addClass("tag_fixed"):dayList.find("div").removeClass("tag_fixed");var t=0;prodTabTitle.find("li").each(function(i){a>=$(".prod_tab_info>div").eq(i).offset().top-45&&(t=i)}),prodTabTitle.find("li").eq(t).addClass("select").siblings().removeClass("select");var i=0;dayList.find("a").each(function(t){a>=$(".trip_list").eq(t).offset().top-60&&(i=t)}),dayList.find("a").eq(i).addClass("current").siblings().removeClass("current")}),prodTabTitle.find("li").click(function(){var a=$(this).index();$("html,body").animate({scrollTop:$(".prod_tab_info>div").eq(a).offset().top-45},500)}),dayList.find("a").click(function(){var a=$(this).index();$("html,body").animate({scrollTop:$(".trip_list").eq(a).offset().top-60},500)}),$("#reserve").click(function(){var a=$(".down_img");"none"==a.css("display")?a.fadeIn():a.fadeOut()}),$("#collect").click(function(){var a=$(this);a.hasClass("has")?$.post("/favorite/favorite/cancle",{dataid:$("#id").val()},function(){a.removeClass("has")},"json"):$.post("/favorite/favorite/add",{dataid:$("#id").val()},function(){a.addClass("has")},"json")});var jiathis_config={siteNum:3,sm:"weixin,qzone,tsina",summary:"",boldNum:3,shortUrl:!1,hideMore:!0};